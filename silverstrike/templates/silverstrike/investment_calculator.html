{% extends 'silverstrike/base.html' %}
{% load i18n %}
{% load static %}

{% block content_header %}
<h1>{% trans 'Investment Calculator' %}</h1>
<ol class="breadcrumb">
  <li><a href="/">{% trans 'Home' %}</a></li>
  <li class="active">{% trans 'Charts' %}</li>
</ol>
{% endblock %}
{% block content %}
<div id="loader-body">
    <div class="loader loader-content" id="loader"></div>
    <div class="loader-text loader-content">
        Calculating operations ...
    </div>
</div>
<div id="main">
    <div class="row">
    <div class="col-md-8">
    <div class="box">
      <div class="box-header">
        <h3 class="box-title">Security Operations</h3>
      </div>
      <div class="box-body">
          <table class="table table-striped">
              <tr>
                <th>{% trans 'Operation' %}</th>
                <th>{% trans 'Securities' %}</th>
                <th>{% trans 'Units' %}</th>
                <th>Unit Value</th>
                <th>Total Value</th>
                <th>Stocks After Operation</th>


              </tr>
              {% for operation in security_operations %}
                 <tr>
                    <td>{{ operation.operation }}</td>
                    <td>{{ operation.ticker }}</td>
                    <td {% if operation.units > 0 %} class="text-green"{% else %} class="text-red" {% endif %}>{{ operation.units }}</td>
                   <!-- <td {% if element > 0 %} class="text-green"{% else %} class="text-red" {% endif %}>+10</td> -->
                   <td>{{ operation.unit_price }} €</td>
                   <td>{{ operation.total_price }} €</td>
                   <td>{{ operation.total_units }}</td>

                 </tr>
              {% endfor %}
           </table>
          {% if security_operations is not None %}
            <input type="submit" class="btn btn-primary" value="Save">
          {% endif %}

      </div>
    </div>
    </div>
    <div class="col-md-4">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Value Change</h3>
        </div>
        <div class="box-body">
          <table class="table">
            <form method="post">
              {% csrf_token %}
              <tr>
                  <th>{% trans 'Amount' %}</th><td><input name="amount" type="number" value="{{ amount }}" step="0.01"></td><td>€</td>

                </tr>
                <tr>
                  <th>{% trans 'Operation' %}</th>
                  <td>
                    <select name="select">
                      <option value="buy" selected>Buy</option>
                      <option value="sell">Sell</option>
                      <option value="rebalance">Rebalance</option>
                    </select>
                  </td>

                </tr>
                <tr>
                    <td><input type="submit" class="btn btn-primary" value="Calculate" onclick="blurToggle()"></td>
                </tr>
            </form>
            </table>
        </div>
      </div>
    </div>
    </div>
    <div class="row">
    <div class="col-md-12">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">World Stock Distribution</h3>
        </div>
        <div class="box-body">
            <table class="table table-striped">
                <tr>
                  <th></th>
                  {% for region in regionList %}
                    <th>{{ region.1 }}</th>
                  {% endfor %}
                </tr>
                <tr>
                    <th>{% trans 'New' %}</th>
                    {% if not region_weights.values %}
                     {% for region in regionList %}
                        <td>--,- %</td>
                     {% endfor %}
                    {% endif %}
                    {% for weight in region_weights.values %}
                        <td> {{weight | floatformat:1}} %</td>
                    {% endfor %}
                </tr>
                <tr>
                    <th>{% trans 'Target' %}</th>
                    {% for asset in targetWorld %}
                        <td>{{asset.allocation | floatformat:1}} %</td>
                    {% endfor %}
                </tr>
                <tr>
                    <th>{% trans 'Delta' %}</th>
                    {% for asset in targetWorld %}
                        <td>--,- %</td>
                    {% endfor %}
                </tr>
            </table>
        </div>
      </div>
      </div>
    <div class="col-md-8">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Bond Maturity Distribution</h3>
        </div>
        <div class="box-body">
            <table class="table table-striped">
            <tr>
              <th></th>
              {% for maturity in bondMaturityList %}
                    <th>{{ maturity.1}}</th>
                {% endfor %}
            </tr>
            <tr>
              <th>{% trans 'New' %}</th>
                {% if not bond_weights.values %}
                     {% for asset in targetMaturityBonds %}
                    <td> --,- %</td>
                    {% endfor %}
                {% endif %}
                {% for weight in bond_weights.values %}
                    <td> {{weight | floatformat:1}} %</td>
                {% endfor %}
            </tr>
            <tr>
                <th>{% trans 'Target' %}</th>
                {% for asset in targetMaturityBonds %}
                    <td>{{asset.allocation}} %</td>
                {% endfor %}
            </tr>
            <tr>
              <th>{% trans 'Delta' %}</th>
                {% for asset in targetMaturityBonds %}
                    <td> --,- %</td>
                {% endfor %}
            </tr>
            </table>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Asset Distribution</h3>
        </div>
        <div class="box-body">
          <table class="table table-striped">
            <tr>
              <th></th><th>{% trans 'Stocks' %}</th><th>{% trans 'REIT' %}</th><th>{% trans 'Bonds' %}</th>
            </tr>
            <tr>
              <th>{% trans 'New' %}</th>
                {% if not region_weights.values %}
                <!-- TODO -->
                <td>--,- %</td><td>--,- %</td><td>--,- %</td>
                {% endif %}
                {% for weight in asset_weights.values %}
                    <td> {{weight | floatformat:1}} %</td>
                {% endfor %}

            </tr>
            <tr>
              <th>{% trans 'Target' %}</th>
                <td>{{ targetStock.allocation | floatformat:2 }} %</td>
                <td>{{ targetREIT.allocation | floatformat:2 }} %</td>
                <td>{{ targetBond.allocation | floatformat:2 }} %</td>
            </tr>
            <tr>
              <th>{% trans 'Delta' %}</th><td>--,- %</td><td>--,- %</td><td>--,- %</td>
            </tr>
            </table>
        </div>
      </div>
    </div>
</div>
<style>
    .loader {
      border: 10px solid #f3f3f3;
      border-radius: 50%;
      border-top: 10px solid #3498db;
      width: 60px;
      height: 60px;
      -webkit-animation: spin 1.5s linear infinite; /* Safari */
      animation: spin 1.5s linear infinite;

    }
    .loader-content {
      position:absolute;
      top: 0; bottom: 0; left: 0; right: 0;
      margin: auto;
    }

    .loader-text {
        top: 150px;
        width: 60px;
        height: 60px;
        text-align: center;
        font-weight: bold;
    }

    /* Safari */
    @-webkit-keyframes spin {
      0% { -webkit-transform: rotate(0deg); }
      100% { -webkit-transform: rotate(360deg); }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .blurredElement {
         /* Any browser which supports CSS3 */
        filter: blur(7px);

        /* Firefox version 34 and earlier */
        filter: url("blur.svg#gaussian_blur");

        /* Webkit in Chrome 52, Safari 9, Opera 39, and earlier */
        -webkit-filter: blur(7px);
    }

    #loader-body {
      position: fixed; /* Sit on top of the page content */
      display: none; /* Hidden by default */
      width: 100%; /* Full width (cover the whole page) */
      height: 100%; /* Full height (cover the whole page) */
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 2; /* Specify a stack order in case you're using a different order for other elements */
      cursor: pointer; /* Add a pointer on hover */
    }
</style>
<script type="text/javascript">
function blurToggle(){
    var element = $("#main");
    var loader = $("#loader-body");
    if(element.hasClass("blurredElement")){
        element.removeClass("blurredElement");
        loader.hide();
    } else {
        element.addClass("blurredElement");
        loader.show();
    }
 }
</script>
{% endblock %}